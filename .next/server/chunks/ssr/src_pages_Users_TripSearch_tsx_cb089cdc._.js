module.exports=[406180,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(554928),e=a.i(352477),f=a.i(285547),g=a.i(642351),h=a.i(259212),i=a.i(820840),j=a.i(334967),k=a.i(11536),l=a.i(876498),m=a.i(248220),n=a.i(81419),o=a.i(371829),p=a.i(418213),q=a.i(83490),r=a.i(105579),s=a.i(571987);let t={src:a.i(218677).default,width:90,height:90,blurWidth:8,blurHeight:8,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAMElEQVR42qXNuwkAIBRD0bf/WkHywaEUOxEbPe0NpPpFvQZJtkkm2UJbAMzF58dpAJnnmIYPWUN+AAAAAElFTkSuQmCC"};a.i(802407);var u=a.i(778134),v=a.i(406704),w=a.i(192676),x=a.i(695245),y=a.i(50944),z=a.i(911156),A=a.i(992258),B=a.i(124987),C=a.i(963519),D=a.i(546842),E=a.i(633508);let F=({modal:a,getModal:f,booking:i,buttonText:j="Pay Now"})=>{let{t:p}=(0,u.useTranslation)();(0,y.useRouter)();let{register:s,reset:t,getValues:F,setValue:G,watch:H,handleSubmit:I,formState:{errors:J}}=(0,x.useForm)(),[K,L]=(0,c.useState)(!1),{state:M}=(0,d.useStateMachine)({updateBooking:e.updateBooking,updateAction:e.updateAction,updateUser:e.updateUser}),N=M?.trip?.trip??M?.trip,O=new w.default({length:10,dictionary:"alphanum_upper"}).rnd();(0,c.useEffect)(()=>{i&&t({data:i})},[i,t]);let P=async()=>{if(L(!0),F("phoneNumber"),F("name"),F("idCardNo"),F("payerEmail"),!F("seat")){v.toast.error(p("seat_required")||"Please select a seat"),L(!1);return}let a={total_amount:N?.price||100,currency:"XAF",transaction_id:O,return_url:"http://localhost:3000/payunit-return/:transaction_id/:transaction_amount/:transaction_gateway/:transaction_status/:purchaseRef/:currency"};try{let{data:b}=await q.default.post("api/v1/payunit/initialize",a);b?.error&&(v.toast.error(b.message),L(!1))}catch(a){if(q.default.isAxiosError(a)){let b=a.response?.data?.message||"Payment initialization failed";v.toast.error(b)}else v.toast.error("An unexpected error occurred");L(!1)}},[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)(!1),U=(0,c.useMemo)(()=>{let a=Number(N?.seats);return Number.isFinite(a)&&a>0?a:0},[N?.seats]);(0,c.useEffect)(()=>{(async()=>{if(a.modal_static&&N?.id){T(!0);try{let{data:a}=await q.default.get(`api/v1/bookings/trip-seats/${N.id}`);a?.error?R([]):R(a?.data?.takenSeats||[])}catch{R([])}finally{T(!1)}}})()},[a.modal_static,N?.id]);let V=H("seat"),W=(0,c.useMemo)(()=>{if(U<=0)return[];let a=Array.from({length:U},(a,b)=>String(b+1)),b=[];for(let c=0;c<a.length;c+=4)b.push({left:[a[c]??null,a[c+1]??null],right:[a[c+2]??null,a[c+3]??null]});return b},[U]),X=({seat:a})=>{if(!a)return(0,b.jsx)("div",{className:"ta-seat ta-seat--empty","aria-hidden":"true"});let c=Q.includes(a),d=V===a;return(0,b.jsx)("button",{type:"button",className:`ta-seat ${c?"is-taken":"is-available"} ${d?"is-selected":""}`,disabled:c,onClick:()=>{G("seat",a,{shouldValidate:!0,shouldDirty:!0})},"aria-label":`Seat ${a}${c?" (taken)":d?" (selected)":""}`,children:a},a)};return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(l.Modal,{isOpen:a.modal_static,backdrop:"static",centered:!0,size:"lg",contentClassName:"ta-modal",children:[(0,b.jsx)(m.ModalHeader,{className:"ta-modal__header",children:(0,b.jsxs)("div",{className:"ta-modal__headerInner",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"ta-modal__kicker",children:p("booking_details")||"Booking details"}),(0,b.jsxs)("div",{className:"ta-modal__title",children:[(0,b.jsx)(B.MapPin,{size:18}),(0,b.jsx)("span",{children:N?.from_location||"-"}),(0,b.jsx)("span",{className:"ta-modal__arrow",children:"→"}),(0,b.jsx)("span",{children:N?.to_location||"-"})]})]}),(0,b.jsx)("button",{type:"button",className:"ta-modal__close",onClick:()=>f({modal_static:!1}),"aria-label":p("close")||"Close",children:(0,b.jsx)(E.X,{size:18})})]})}),(0,b.jsx)(n.ModalBody,{children:(0,b.jsxs)("form",{onSubmit:I(P),children:[(0,b.jsxs)(g.Row,{children:[(0,b.jsxs)(h.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"ta-field",children:[(0,b.jsx)("label",{htmlFor:"name",className:"ta-field__label",children:p("name")}),(0,b.jsxs)("div",{className:"ta-field__control",children:[(0,b.jsx)("span",{className:"ta-field__icon","aria-hidden":"true",children:(0,b.jsx)(D.User,{size:16})}),(0,b.jsx)("input",{type:"text",id:"name",className:"form-control ta-input",...s("name",{required:!0,minLength:2})})]})]}),J.name&&(0,b.jsx)("p",{style:{color:"red"},children:p("agency_branch_err")})]}),(0,b.jsxs)(h.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"ta-field",children:[(0,b.jsx)("label",{htmlFor:"idCardNo",className:"ta-field__label",children:p("id_card")}),(0,b.jsxs)("div",{className:"ta-field__control",children:[(0,b.jsx)("span",{className:"ta-field__icon","aria-hidden":"true",children:(0,b.jsx)(z.CreditCard,{size:16})}),(0,b.jsx)("input",{type:"text",id:"idCardNo",className:"form-control ta-input",...s("idCardNo",{required:!0})})]})]}),J.idCardNo&&(0,b.jsx)("p",{style:{color:"red"},children:p("id_card_err")})]}),(0,b.jsxs)(h.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"ta-field",children:[(0,b.jsx)("label",{htmlFor:"phoneNumber",className:"ta-field__label",children:p("phone")}),(0,b.jsxs)("div",{className:"ta-field__control",children:[(0,b.jsx)("span",{className:"ta-field__icon","aria-hidden":"true",children:(0,b.jsx)(C.Phone,{size:16})}),(0,b.jsx)("input",{type:"tel",inputMode:"numeric",id:"phoneNumber",placeholder:p("valid_momo_number")||"Valid money transfer number",className:"form-control ta-input",...s("phoneNumber",{required:!0,minLength:9,maxLength:12})})]})]}),J.phoneNumber&&(0,b.jsx)("p",{style:{color:"red"},children:p("phone_err")})]}),(0,b.jsxs)(h.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"ta-field",children:[(0,b.jsx)("label",{htmlFor:"payerEmail",className:"ta-field__label",children:p("email_address")}),(0,b.jsxs)("div",{className:"ta-field__control",children:[(0,b.jsx)("span",{className:"ta-field__icon","aria-hidden":"true",children:(0,b.jsx)(A.Mail,{size:16})}),(0,b.jsx)("input",{type:"email",id:"payerEmail",className:"form-control ta-input",...s("payerEmail",{required:!0})})]})]}),J.payerEmail&&(0,b.jsx)("p",{style:{color:"red"},children:p("phone_err")})]})]}),(0,b.jsxs)("div",{className:"ta-seatmap mt-3",children:[(0,b.jsxs)("div",{className:"ta-seatmap__header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"ta-seatmap__title",children:p("seat")||"Seat"}),(0,b.jsx)("div",{className:"ta-seatmap__subtitle",children:S?p("loading")||"Loading...":p("select_seat")||"Select your seat"})]}),(0,b.jsxs)("div",{className:"ta-seatmap__legend",children:[(0,b.jsx)("span",{className:"ta-legend is-available",children:p("available")||"Available"}),(0,b.jsx)("span",{className:"ta-legend is-selected",children:p("selected")||"Selected"}),(0,b.jsx)("span",{className:"ta-legend is-taken",children:p("taken")||"Taken"})]})]}),(0,b.jsx)("input",{type:"hidden",...s("seat",{required:!0})}),J.seat?(0,b.jsx)("div",{className:"text-danger mt-1",children:p("seat_required")||"Please select a seat"}):null,U>0?(0,b.jsxs)("div",{className:"ta-seatmap__bus",role:"group","aria-label":p("seat_map")||"Seat map",children:[(0,b.jsx)("div",{className:"ta-seatmap__driver","aria-hidden":"true",children:p("driver")||"Driver"}),(0,b.jsx)("div",{className:"ta-seatmap__rows",children:W.map((a,c)=>(0,b.jsxs)("div",{className:"ta-seatmap__row",children:[(0,b.jsxs)("div",{className:"ta-seatmap__side",children:[(0,b.jsx)(X,{seat:a.left[0]}),(0,b.jsx)(X,{seat:a.left[1]})]}),(0,b.jsx)("div",{className:"ta-seatmap__aisle","aria-hidden":"true"}),(0,b.jsxs)("div",{className:"ta-seatmap__side",children:[(0,b.jsx)(X,{seat:a.right[0]}),(0,b.jsx)(X,{seat:a.right[1]})]})]},c))})]}):(0,b.jsx)("div",{className:"text-muted",children:p("no_seat_map")||"Seat map not available for this trip"})]}),(0,b.jsx)(o.ModalFooter,{children:K?(0,b.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:(0,b.jsx)(r.SpinnerCircular,{color:"#bcc015",size:50,"aria-label":"Loading Spinner","data-testid":"loader"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Button,{color:"light",onClick:()=>f({modal_static:!1}),children:p("cancel")}),(0,b.jsx)(k.Button,{type:"submit",color:"primary",children:j})]})})]})})]})})};var G=a.i(238246),H=a.i(131030),I=a.i(910176),J=a.i(310437),K=a.i(708306);a.s(["default",0,()=>{let{t:a}=(0,u.useTranslation)(),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(null),{actions:E,state:L}=(0,d.useStateMachine)({updateSearch:e.updateSearch,updateAction:e.updateAction}),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!0),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(K.DEFAULT_TRIP_FILTERS),U=(0,c.useRef)(null),[V,W]=(0,c.useState)({modal_static:!1}),[X,Y]=(0,c.useState)({modal_static:!1}),[Z,$]=(0,c.useState)({modal_static:!1}),_=L?.search,aa="string"==typeof _?.journeyDate?_.journeyDate:_?.journeyDate?(0,p.default)(_.journeyDate).format("YYYY-MM-DD"):"",ab="string"==typeof _?.from?_.from:_?.from?.value||"",ac="string"==typeof _?.to?_.to:_?.to?.value||"",ad="string"==typeof _?.departureTime?_.departureTime:_?.departureTime?(0,p.default)(_.departureTime).format("HH:mm"):"",ae=_?.journeyDate?(0,p.default)(_.journeyDate).toDate():void 0,af=_?.departureTime?(0,p.default)(_.departureTime,["HH:mm","hh:mm A"]).toDate():void 0;function ag(){x(!1),$({modal_static:!1})}let ah=()=>{z(!1),Y({modal_static:!1}),B(""),D(null)},ai=(0,c.useCallback)(async()=>{try{R(null),P(!0);let{data:a}=await q.default.get("api/v1/trips/trip-search",{params:{from:ab,to:ac,journeyDate:aa,departureTime:ad}});if(a?.error)R(a.message||"Failed to fetch trips"),v.toast.error(a.message);else{let b=a.data??[];N(b)}}catch(a){if(q.default.isAxiosError(a)){let b=a.response?.data?.message||a.message||"Failed to fetch trips";R(b),v.toast.error(b)}else R("An unexpected error occurred"),v.toast.error("An unexpected error occurred")}finally{P(!1)}},[ab,ac,aa,ad]);(0,c.useEffect)(()=>{"undefined"!=typeof document&&document.body.setAttribute("style","background: #f1f5f7!important;"),ai()},[ai]);let aj=M.filter(a=>a.reserved!==a.seats),ak=(0,K.sortTrips)((0,K.applyTripFilters)(aj,S),S.sort),al=aj.length>0,am=ak.length>0;return O?(0,b.jsx)(c.default.Fragment,{children:(0,b.jsx)("div",{className:"page-content",children:(0,b.jsx)(j.Container,{fluid:!0,className:"",children:(0,b.jsx)("div",{className:"loader-outer",children:(0,b.jsx)("div",{className:"loader-inner",children:(0,b.jsx)(r.SpinnerCircular,{color:"#bcc014",size:50})})})})})}):(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("section",{className:"trip-search mb-5",children:(0,b.jsxs)("div",{className:"container",children:[!O&&(Q||!al)&&(0,b.jsx)("div",{className:"row pt-5 mb-4",children:(0,b.jsx)("div",{className:"col-lg-12",children:(0,b.jsx)(f.Card,{children:(0,b.jsxs)(i.CardBody,{children:[Q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("h4",{className:"mb-2",children:[a("Failed")," / ",a("error")||"Error"]}),(0,b.jsx)("p",{className:"mb-3",children:Q})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h4",{className:"mb-2",children:a("no_bus")||"No buses found"}),(0,b.jsxs)("p",{className:"mb-3",children:[a("no_bus")||"No buses were found for your search."," ",ab&&ac?(0,b.jsxs)(b.Fragment,{children:["(",ab," → ",ac,")"]}):null]})]}),(0,b.jsx)("div",{className:"d-flex gap-2 flex-wrap",children:(0,b.jsx)(k.Button,{color:"primary",onClick:()=>ai(),children:a("retry")||"Retry"})}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("h6",{className:"mb-3",children:a("modify_search")||"Modify search"}),(0,b.jsx)(H.default,{text:"book",initialFrom:ab||void 0,initialTo:ac||void 0,initialJourneyDate:ae,initialDepartureTime:af}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(I.default,{})}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(G.default,{href:"/book",className:"btn btn-outline-secondary",children:a("back")||"Back"})})]})]})})})}),(0,b.jsx)("div",{className:"row pt-5 mb-4",children:(0,b.jsx)("div",{className:"col-lg-12",children:al?(0,b.jsxs)("h6",{children:[am?ak.length:0," ",a("buses")," ",a("from")," ",ab," ",a("to")," ",ac]}):(0,b.jsxs)("h6",{children:[aj.length," ",a("no_bus")," ",a("from")," ",ab," ",a("to")," ",ac]})})}),al&&(0,b.jsx)(J.default,{trips:aj,filters:S,onChange:T}),(0,b.jsx)("div",{className:"row",children:(0,b.jsxs)("div",{className:"col-lg-12",children:[!am&&al?(0,b.jsx)(f.Card,{children:(0,b.jsxs)(i.CardBody,{children:[(0,b.jsx)("h5",{className:"mb-2",children:"No trips match your filters"}),(0,b.jsx)("p",{className:"mb-0 text-muted",children:"Try widening your price/time window or resetting filters."})]})}):null,ak.map(c=>(0,b.jsx)(f.Card,{className:"ta-trip-card",children:(0,b.jsxs)(i.CardBody,{className:"ta-trip-card__body",children:[(0,b.jsxs)("div",{className:"ta-trip-card__left",children:[(0,b.jsx)("div",{className:"ta-trip-card__logo",children:c.agency_logo?(0,b.jsx)(s.default,{src:c.agency_logo,alt:"agency logo",width:44,height:44}):(0,b.jsx)(s.default,{src:t,alt:"logo",width:44,height:44})}),(0,b.jsxs)("div",{className:"ta-trip-card__meta",children:[(0,b.jsxs)("div",{className:"ta-trip-card__top",children:[(0,b.jsx)("div",{className:"ta-trip-card__agency",children:c.agency_name}),(0,b.jsx)("span",{className:"badge rounded-pill text-bg-light",children:c.trip_type||"Standard"})]}),(0,b.jsxs)("div",{className:"ta-trip-card__route",children:[(0,b.jsx)("strong",{children:c.from_location})," ",(0,b.jsx)("span",{className:"text-muted",children:"→"})," ",(0,b.jsx)("strong",{children:c.to_location})]}),(0,b.jsxs)("div",{className:"ta-trip-card__sub",children:[(0,b.jsxs)("span",{children:[a("departure"),": ",String(c.departure||"")]}),(0,b.jsx)("span",{className:"ta-dot",children:"•"}),(0,b.jsxs)("span",{children:[a("available_seats"),": ",(0,K.availableSeats)(c)]})]})]})]}),(0,b.jsxs)("div",{className:"ta-trip-card__right",children:[(0,b.jsxs)("div",{className:"ta-trip-card__price",children:[(0,b.jsx)("div",{className:"ta-trip-card__price-label",children:a("price")}),(0,b.jsxs)("div",{className:"ta-trip-card__price-value",children:[c.price," XAF"]})]}),c.reserved!==c.seats?(0,b.jsx)(k.Button,{color:"primary",className:"ta-btn-primary",onClick:()=>{U.current=c,E.updateAction({trip:U.current}),W({modal_static:!0})},children:a("get_ticket")}):(0,b.jsx)(k.Button,{disabled:!0,className:"ta-btn-primary",children:a("sold_out")||"Sold Out"})]})]})},c.id))]})}),(0,b.jsx)(F,{getModal:W,modal:V,booking:U.current||void 0,buttonText:a("buy")}),y&&(0,b.jsxs)(l.Modal,{isOpen:X.modal_static,toggle:ah,centered:!0,size:"sm",children:[(0,b.jsxs)(m.ModalHeader,{toggle:ah,children:[a("Success"),"!"]}),(0,b.jsx)(n.ModalBody,{children:(0,b.jsx)(g.Row,{children:(0,b.jsxs)(h.Col,{lg:12,children:[(0,b.jsxs)("p",{className:"text-center",children:[a("ticket_num")," ",A]}),(0,b.jsxs)("p",{className:"text-center",children:[a("seat"),": ",C]})]})})}),(0,b.jsx)(o.ModalFooter,{children:(0,b.jsx)(k.Button,{color:"primary",onClick:ah,children:"OK"})})]}),w&&(0,b.jsxs)(l.Modal,{isOpen:Z.modal_static,toggle:ag,centered:!0,size:"sm",children:[(0,b.jsxs)(m.ModalHeader,{toggle:ag,children:[a("Failed"),"!"]}),(0,b.jsx)(n.ModalBody,{children:(0,b.jsx)(g.Row,{children:(0,b.jsx)(h.Col,{lg:12,children:(0,b.jsx)("p",{className:"text-center",children:a("failed_booking")})})})}),(0,b.jsx)(o.ModalFooter,{children:(0,b.jsx)(k.Button,{color:"primary",onClick:ag,children:"OK"})})]})]})})})}],406180)}];

//# sourceMappingURL=src_pages_Users_TripSearch_tsx_cb089cdc._.js.map