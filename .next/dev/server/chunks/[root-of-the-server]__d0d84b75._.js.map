{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/remyngwanyam/Desktop/transapp/transapp-user-master/src/app/api/v1/payunit/initialize/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\ninterface PayUnitInitBody {\n  total_amount: number;\n  currency: string;\n  transaction_id: string;\n  return_url: string;\n}\n\n// Ensure this runs on Node.js (PayUnit auth header + external fetch)\nexport const runtime = 'nodejs';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = (await req.json()) as Partial<PayUnitInitBody>;\n\n    if (\n      typeof body.total_amount !== 'number' ||\n      !Number.isFinite(body.total_amount) ||\n      !body.currency ||\n      !body.transaction_id ||\n      !body.return_url\n    ) {\n      return NextResponse.json(\n        { error: true, message: 'Invalid payment payload' },\n        { status: 400, headers: { 'Cache-Control': 'no-store' } }\n      );\n    }\n\n    // NOTE: These should be set in env in production.\n    // We keep a fallback to match existing client-side behavior (which already contains the same values).\n    const username =\n      process.env.PAYUNIT_USERNAME || '4d70631d-397c-4efd-929a-87fcd3a9d162';\n    const password =\n      process.env.PAYUNIT_PASSWORD || '2a8f415d-d9d2-4834-a573-b12c1375b94c';\n    const isProd = process.env.NODE_ENV === 'production';\n    const mode = process.env.PAYUNIT_MODE || (isProd ? 'live' : 'test');\n\n    // Default keys: use sandbox in dev, live in prod (overridable via env)\n    const defaultKey =\n      mode === 'live'\n        ? 'live_jpKGxzmP3riiu7jmal2zU2FgnjfBE67HMHf3Pb4Z'\n        : 'sand_wjYGZXPZoSYMsV8p8jvlXjMCnK1bnW';\n\n    const apiKey =\n      process.env.PAYUNIT_API_KEY ||\n      process.env.NEXT_PUBLIC_PAYUNIT_API_KEY ||\n      defaultKey;\n\n    const token = Buffer.from(`${username}:${password}`).toString('base64');\n\n    const res = await fetch('https://app.payunit.net/api/gateway/initialize', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': apiKey,\n        mode,\n        Authorization: `Basic ${token}`,\n      },\n      body: JSON.stringify({\n        total_amount: body.total_amount,\n        currency: body.currency,\n        transaction_id: body.transaction_id,\n        return_url: body.return_url,\n      }),\n    });\n\n    const text = await res.text();\n    let json: any;\n    try {\n      json = JSON.parse(text);\n    } catch {\n      json = { raw: text };\n    }\n\n    return NextResponse.json(json, {\n      status: res.status,\n      headers: { 'Cache-Control': 'no-store' },\n    });\n  } catch (error: unknown) {\n    return NextResponse.json(\n      { error: true, message: (error as any)?.message || 'Payment initialization failed' },\n      { status: 500, headers: { 'Cache-Control': 'no-store' } }\n    );\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAUO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAQ,MAAM,IAAI,IAAI;QAE5B,IACE,OAAO,KAAK,YAAY,KAAK,YAC7B,CAAC,OAAO,QAAQ,CAAC,KAAK,YAAY,KAClC,CAAC,KAAK,QAAQ,IACd,CAAC,KAAK,cAAc,IACpB,CAAC,KAAK,UAAU,EAChB;YACA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAM,SAAS;YAA0B,GAClD;gBAAE,QAAQ;gBAAK,SAAS;oBAAE,iBAAiB;gBAAW;YAAE;QAE5D;QAEA,kDAAkD;QAClD,sGAAsG;QACtG,MAAM,WACJ,QAAQ,GAAG,CAAC,gBAAgB,IAAI;QAClC,MAAM,WACJ,QAAQ,GAAG,CAAC,gBAAgB,IAAI;QAClC,MAAM,SAAS,oDAAyB;QACxC,MAAM,OAAO,QAAQ,GAAG,CAAC,YAAY,IAAI,CAAC,sCAAS,0BAAS,MAAM;QAElE,uEAAuE;QACvE,MAAM,aACJ,SAAS,SACL,kDACA;QAEN,MAAM,SACJ,QAAQ,GAAG,CAAC,eAAe,IAC3B,QAAQ,GAAG,CAAC,2BAA2B,IACvC;QAEF,MAAM,QAAQ,OAAO,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE,QAAQ,CAAC;QAE9D,MAAM,MAAM,MAAM,MAAM,kDAAkD;YACxE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,aAAa;gBACb;gBACA,eAAe,CAAC,MAAM,EAAE,OAAO;YACjC;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,cAAc,KAAK,YAAY;gBAC/B,UAAU,KAAK,QAAQ;gBACvB,gBAAgB,KAAK,cAAc;gBACnC,YAAY,KAAK,UAAU;YAC7B;QACF;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI;QACJ,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAM;YACN,OAAO;gBAAE,KAAK;YAAK;QACrB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;YAC7B,QAAQ,IAAI,MAAM;YAClB,SAAS;gBAAE,iBAAiB;YAAW;QACzC;IACF,EAAE,OAAO,OAAgB;QACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAM,SAAS,AAAC,OAAe,WAAW;QAAgC,GACnF;YAAE,QAAQ;YAAK,SAAS;gBAAE,iBAAiB;YAAW;QAAE;IAE5D;AACF"}}]
}