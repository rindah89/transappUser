{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/remyngwanyam/Desktop/transapp/transapp-user-master/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport { Database } from '../types/database.types';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl) {\n  throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_URL environment variable');\n}\n\nif (!supabaseAnonKey && !supabaseServiceKey) {\n  throw new Error('Missing NEXT_PUBLIC_SUPABASE_ANON_KEY, NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY, or SUPABASE_SERVICE_ROLE_KEY environment variable');\n}\n\n// Client for client-side operations (uses anon/publishable key, respects RLS)\nexport const supabase = supabaseAnonKey\n  ? createClient<Database>(supabaseUrl, supabaseAnonKey, {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        detectSessionInUrl: true\n      }\n    })\n  : null;\n\n// Client for server-side admin operations (uses service role key - REQUIRED for API routes)\n// WARNING: Only use this in API routes or getServerSideProps. NEVER expose to client.\n// Only check for service key on server side (not during client-side module evaluation)\nconst isServer = typeof window === 'undefined';\n\nif (isServer && !supabaseServiceKey) {\n  console.error('⚠️  SUPABASE_SERVICE_ROLE_KEY is missing! Server-side API routes will not work.');\n  console.error('   Get it from: Supabase Dashboard → Settings → API → service_role key');\n  console.error('   Make sure it\\'s in your .env.local file (not .env, as .env.local is not committed to git)');\n}\n\nexport const supabaseAdmin = supabaseServiceKey\n  ? createClient<Database>(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n        detectSessionInUrl: false\n      },\n      db: {\n        schema: 'public'\n      }\n    })\n  : (() => {\n      // Only throw error on server side when actually trying to use it\n      if (isServer) {\n        throw new Error(\n          'SUPABASE_SERVICE_ROLE_KEY is required for server-side operations.\\n' +\n          'Please add it to your .env.local file:\\n' +\n          'SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here\\n' +\n          'Get it from: Supabase Dashboard → Settings → API → service_role key'\n        );\n      }\n      // On client side, return a dummy object that will throw if used\n      return null as any;\n    })();\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,MAAM,cAAc,gFAAwC,QAAQ,GAAG,CAAC,YAAY;AACpF,MAAM,kBAAkB,QAAQ,GAAG,CAAC,6BAA6B;AACjE,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE;;AAIA;;AAKO,MAAM,WAAW,uCACpB,IAAA,yLAAY,EAAW,aAAa,iBAAiB;IACnD,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;QAClB,oBAAoB;IACtB;AACF,KACA;AAEJ,4FAA4F;AAC5F,sFAAsF;AACtF,uFAAuF;AACvF,MAAM,WAAW,kDAAkB;AAEnC,IAAI,YAAY,CAAC,oBAAoB;IACnC,QAAQ,KAAK,CAAC;IACd,QAAQ,KAAK,CAAC;IACd,QAAQ,KAAK,CAAC;AAChB;AAEO,MAAM,gBAAgB,qBACzB,IAAA,yLAAY,EAAW,aAAa,oBAAoB;IACtD,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;IACA,IAAI;QACF,QAAQ;IACV;AACF,KACA,CAAC;IACC,iEAAiE;IACjE,wCAAc;QACZ,MAAM,IAAI,MACR,wEACA,6CACA,2DACA;IAEJ;IACA,gEAAgE;IAChE,OAAO;AACT,CAAC"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/remyngwanyam/Desktop/transapp/transapp-user-master/src/exceptions/HttpException.ts"],"sourcesContent":["export class HttpException extends Error {\n  public status: number;\n  public message: string;\n\n  constructor(status: number, message: string) {\n    super(message);\n    this.status = status;\n    this.message = message;\n  }\n}\n"],"names":[],"mappings":";;;;AAAO,MAAM,sBAAsB;IAC1B,OAAe;IACf,QAAgB;IAEvB,YAAY,MAAc,EAAE,OAAe,CAAE;QAC3C,KAAK,CAAC;QACN,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,OAAO,GAAG;IACjB;AACF"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///Users/remyngwanyam/Desktop/transapp/transapp-user-master/src/app/api/v1/bookings/trip-seats/%5BtripId%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabaseAdmin } from '@databases/supabase';\nimport { HttpException } from '@exceptions/HttpException';\n\ninterface TripSeatsResponse {\n  error: boolean;\n  message: string;\n  data?: {\n    tripId: number;\n    takenSeats: string[];\n  };\n}\n\nexport async function GET(\n  _request: NextRequest,\n  context: { params: { tripId: string } } | { params: Promise<{ tripId: string }> }\n): Promise<NextResponse<TripSeatsResponse>> {\n  try {\n    const { tripId: tripIdParam } = await (context as any).params;\n    const tripId = Number(tripIdParam);\n    if (!Number.isFinite(tripId)) {\n      return NextResponse.json(\n        { error: true, message: 'Invalid trip id' },\n        { status: 400, headers: { 'Cache-Control': 'no-store' } }\n      );\n    }\n\n    const { data, error } = await supabaseAdmin\n      .from('bookings')\n      .select('seat,status')\n      .eq('trip_id', tripId)\n      .not('seat', 'is', null);\n\n    if (error) throw new HttpException(500, error.message);\n\n    const takenSeats = (data || [])\n      .filter((r: any) => (r?.status || '').toUpperCase() !== 'CANCELLED')\n      .map((r: any) => String(r.seat))\n      .filter(Boolean);\n\n    return NextResponse.json<TripSeatsResponse>(\n      { error: false, message: 'Trip seats retrieved successfully', data: { tripId, takenSeats } },\n      { headers: { 'Cache-Control': 'no-store' } }\n    );\n  } catch (error: unknown) {\n    const httpError = error as { status?: number; message?: string };\n    return NextResponse.json<TripSeatsResponse>(\n      { error: true, message: httpError.message || 'Failed to retrieve trip seats' },\n      { status: httpError.status || 500, headers: { 'Cache-Control': 'no-store' } }\n    );\n  }\n}\n\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAWO,eAAe,IACpB,QAAqB,EACrB,OAAiF;IAEjF,IAAI;QACF,MAAM,EAAE,QAAQ,WAAW,EAAE,GAAG,MAAM,AAAC,QAAgB,MAAM;QAC7D,MAAM,SAAS,OAAO;QACtB,IAAI,CAAC,OAAO,QAAQ,CAAC,SAAS;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAM,SAAS;YAAkB,GAC1C;gBAAE,QAAQ;gBAAK,SAAS;oBAAE,iBAAiB;gBAAW;YAAE;QAE5D;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAa,CACxC,IAAI,CAAC,YACL,MAAM,CAAC,eACP,EAAE,CAAC,WAAW,QACd,GAAG,CAAC,QAAQ,MAAM;QAErB,IAAI,OAAO,MAAM,IAAI,qJAAa,CAAC,KAAK,MAAM,OAAO;QAErD,MAAM,aAAa,CAAC,QAAQ,EAAE,EAC3B,MAAM,CAAC,CAAC,IAAW,CAAC,GAAG,UAAU,EAAE,EAAE,WAAW,OAAO,aACvD,GAAG,CAAC,CAAC,IAAW,OAAO,EAAE,IAAI,GAC7B,MAAM,CAAC;QAEV,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAO,SAAS;YAAqC,MAAM;gBAAE;gBAAQ;YAAW;QAAE,GAC3F;YAAE,SAAS;gBAAE,iBAAiB;YAAW;QAAE;IAE/C,EAAE,OAAO,OAAgB;QACvB,MAAM,YAAY;QAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAM,SAAS,UAAU,OAAO,IAAI;QAAgC,GAC7E;YAAE,QAAQ,UAAU,MAAM,IAAI;YAAK,SAAS;gBAAE,iBAAiB;YAAW;QAAE;IAEhF;AACF"}}]
}