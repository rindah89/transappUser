module.exports=[25060,a=>{"use strict";var b=a.i(87924),c=a.i(46088),d=a.i(72131),e=a.i(30767),f=a.i(52477),g=a.i(85547),h=a.i(42351),i=a.i(59212),j=a.i(20840),k=a.i(34967),l=a.i(11536),m=a.i(76498),n=a.i(48220),o=a.i(81419),p=a.i(71829),q=a.i(18213),r=a.i(83490),s=a.i(5579),t=a.i(71987);let u={src:a.i(18677).default,width:90,height:90,blurWidth:8,blurHeight:8,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAMElEQVR42qXNuwkAIBRD0bf/WkHywaEUOxEbPe0NpPpFvQZJtkkm2UJbAMzF58dpAJnnmIYPWUN+AAAAAElFTkSuQmCC"};a.i(2407);var v=a.i(78134),w=a.i(6704),x=a.i(50944),y=a.i(92676),z=a.i(95245);let A=({modal:a,getModal:c,booking:g,buttonText:j="Pay Now"})=>{let{t:k}=(0,v.useTranslation)();(0,x.useRouter)();let{register:q,reset:t,getValues:u,handleSubmit:A,formState:{errors:B}}=(0,z.useForm)(),[C,D]=(0,d.useState)(!1),{state:E}=(0,e.useStateMachine)({updateBooking:f.updateBooking,updateAction:f.updateAction,updateUser:f.updateUser}),F="4d70631d-397c-4efd-929a-87fcd3a9d162:2a8f415d-d9d2-4834-a573-b12c1375b94c",G="undefined"!=typeof Buffer?Buffer.from(F).toString("base64"):btoa(F),H=new y.default({length:10,dictionary:"alphanum_upper"})();(0,d.useEffect)(()=>{g&&t({data:g})},[g,t]);let I=async()=>{D(!0),u("phoneNumber"),u("name"),u("idCardNo"),u("payerEmail");let a={headers:{"x-api-key":process.env.NEXT_PUBLIC_PAYUNIT_API_KEY||"live_jpKGxzmP3riiu7jmal2zU2FgnjfBE67HMHf3Pb4Z",mode:"live","Content-Type":"application/json",Authorization:"Basic "+G}},b=E?.trip?.trip,c={total_amount:b?.price||100,currency:"XAF",transaction_id:H,return_url:"http://localhost:3000/payunit-return/:transaction_id/:transaction_amount/:transaction_gateway/:transaction_status/:purchaseRef/:currency"};try{let{data:b}=await r.default.post("https://app.payunit.net/api/gateway/initialize",c,a);b?.error&&(w.toast.error(b.message),D(!1))}catch(a){D(!1),r.default.isAxiosError(a)?w.toast.error(a.response?.data?.message||"Payment initialization failed"):w.toast.error("An unexpected error occurred")}},J=E?.trip?.trip;return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(m.Modal,{isOpen:a.modal_static,backdrop:"static",centered:!0,size:"lg",children:[(0,b.jsxs)(n.ModalHeader,{toggle:()=>c({modal_static:!1}),children:["Destination: ",J?.to_location||J?.to]}),(0,b.jsx)(o.ModalBody,{children:(0,b.jsxs)("form",{onSubmit:A(I),children:[(0,b.jsxs)(h.Row,{children:[(0,b.jsxs)(i.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{htmlFor:"name",children:k("name")}),(0,b.jsx)("input",{type:"text",name:"name",id:"name",className:"form-control",...q("name",{required:!0,minLength:6})})]}),B.name&&(0,b.jsx)("p",{style:{color:"red"},children:k("agency_branch_err")})]}),(0,b.jsxs)(i.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{htmlFor:"idCardNo",children:k("id_card")}),(0,b.jsx)("input",{type:"text",name:"idCardNo",id:"idCardNo",className:"form-control",...q("idCardNo",{required:!0})})]}),B.idCardNo&&(0,b.jsx)("p",{style:{color:"red"},children:k("id_card_err")})]}),(0,b.jsxs)(i.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{htmlFor:"phoneNumber",children:k("phone")}),(0,b.jsx)("input",{type:"number",name:"phoneNumber",id:"phoneNumber",placeholder:"Valid money transfer number",className:"form-control",...q("phoneNumber",{required:!0,minLength:9,maxLength:12})})]}),B.phoneNumber&&(0,b.jsx)("p",{style:{color:"red"},children:k("phone_err")})]}),(0,b.jsxs)(i.Col,{lg:6,children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{htmlFor:"payerEmail",children:k("email_address")}),(0,b.jsx)("input",{type:"email",name:"payerEmail",id:"payerEmail",className:"form-control",...q("payerEmail",{required:!0})})]}),B.payerEmail&&(0,b.jsx)("p",{style:{color:"red"},children:k("phone_err")})]})]}),(0,b.jsx)(p.ModalFooter,{children:C?(0,b.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:(0,b.jsx)(s.SpinnerCircular,{color:"#bcc015",size:50,"aria-label":"Loading Spinner","data-testid":"loader"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Button,{color:"light",onClick:()=>c({modal_static:!1}),children:k("cancel")}),(0,b.jsx)(l.Button,{type:"submit",color:"primary",children:j})]})})]})})]})})};process.env.NEXT_PUBLIC_SOCKET_URL||process.env.NEXT_PUBLIC_API_URL;let B=()=>{let{t:a}=(0,v.useTranslation)(),[c,x]=(0,d.useState)(!1),[y,z]=(0,d.useState)(!1),[B,C]=(0,d.useState)(""),[D,E]=(0,d.useState)(null),{actions:F,state:G}=(0,e.useStateMachine)({updateSearch:f.updateSearch,updateAction:f.updateAction}),[H,I]=(0,d.useState)([]),[J,K]=(0,d.useState)(!0),L=(0,d.useRef)(null),[M,N]=(0,d.useState)({modal_static:!1}),[O,P]=(0,d.useState)({modal_static:!1}),[Q,R]=(0,d.useState)({modal_static:!1}),S=G?.search,T=S?.journeyDate?(0,q.default)(S.journeyDate).format("MM-DD-YYYY"):"",U="string"==typeof S?.from?S.from:S?.from?.value||"",V="string"==typeof S?.to?S.to:S?.to?.value||"",W=S?.departureTime?(0,q.default)(S.departureTime,"hh:mm A").format("HH:mm a"):"";function X(){x(!1),R({modal_static:!1})}let Y=()=>{z(!1),P({modal_static:!1})},Z=(0,d.useCallback)(async()=>{try{let{data:a}=await r.default.get("api/v1/trips/trip-search",{params:{from:U,to:V,journeyDate:T,departureTime:W}});if(a?.error)w.toast.error(a.message);else if(a.data){let b=Object.values(a.data);I(b),K(!1)}}catch(a){r.default.isAxiosError(a)?w.toast.error(a.message||"Failed to fetch trips"):w.toast.error("An unexpected error occurred"),K(!1)}},[U,V,T,W]);(0,d.useEffect)(()=>{"undefined"!=typeof document&&document.body.setAttribute("style","background: #f1f5f7!important;"),Z()},[Z]);let $=H.filter(a=>a.reserved!==a.seats);return J?(0,b.jsx)(d.default.Fragment,{children:(0,b.jsx)("div",{className:"page-content",children:(0,b.jsx)(k.Container,{fluid:!0,className:"",children:(0,b.jsx)("div",{className:"loader-outer",children:(0,b.jsx)("div",{className:"loader-inner",children:(0,b.jsx)(s.SpinnerCircular,{color:"#bcc014",size:50})})})})})}):(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("section",{className:"trip-search mb-5",children:(0,b.jsxs)("div",{className:"container",children:[(0,b.jsx)("div",{className:"row pt-5 mb-4",children:(0,b.jsx)("div",{className:"col-lg-12",children:$.length>1?(0,b.jsxs)("h6",{children:[$.length," ",a("buses")," ",a("from")," ",U," ",a("to")," ",V]}):(0,b.jsxs)("h6",{children:[$.length," ",a("no_bus")," ",a("from")," ",U," ",a("to")," ",V]})})}),(0,b.jsx)("div",{className:"row",children:(0,b.jsx)("div",{className:"col-lg-12",children:H.map(c=>(0,b.jsx)(g.Card,{children:(0,b.jsx)(j.CardBody,{children:(0,b.jsxs)("div",{className:"row p-2",children:[(0,b.jsx)("div",{className:"col-lg-1",children:(0,b.jsx)("div",{className:"text-center",children:c.agency_logo?(0,b.jsx)(t.default,{src:c.agency_logo,alt:"agency logo",className:"agency_l",width:50,height:50}):(0,b.jsx)(t.default,{src:u,alt:"logo",width:50,height:50})})}),(0,b.jsx)("div",{className:"col-lg-1",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h5",{children:c.trip_type||"Standard"}),(0,b.jsx)("small",{children:a("category")})]})}),(0,b.jsx)("div",{className:"col-lg-2",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h5",{children:c.agency_name}),(0,b.jsx)("small",{children:a("Agency")})]})}),(0,b.jsx)("div",{className:"col-lg-2",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h5",{children:c.departure}),(0,b.jsx)("small",{children:a("departure")})]})}),(0,b.jsx)("div",{className:"col-lg-2",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h5",{children:c.price}),(0,b.jsx)("small",{children:a("price")})]})}),(0,b.jsx)("div",{className:"col-lg-2",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h5",{children:c.seats-c.reserved}),(0,b.jsx)("small",{children:a("available_seats")})]})}),(0,b.jsx)("div",{className:"col-lg-2",children:(0,b.jsx)("div",{className:"text-center",children:c.reserved!==c.seats?(0,b.jsx)(l.Button,{block:!0,color:"primary",onClick:()=>{L.current=c,F.updateAction({trip:L.current}),N({modal_static:!0})},children:a("get_ticket")}):(0,b.jsx)(l.Button,{block:!0,disabled:!0,color:"primary",children:a("sold_out")||"Sold Out"})})})]})})},c.id))})}),(0,b.jsx)(A,{getModal:N,modal:M,booking:L.current||void 0,buttonText:a("buy")}),y&&(0,b.jsxs)(m.Modal,{isOpen:O.modal_static,toggle:Y,centered:!0,size:"sm",children:[(0,b.jsxs)(n.ModalHeader,{toggle:Y,children:[a("Success"),"!"]}),(0,b.jsx)(o.ModalBody,{children:(0,b.jsx)(h.Row,{children:(0,b.jsxs)(i.Col,{lg:12,children:[(0,b.jsxs)("p",{className:"text-center",children:[a("ticket_num")," ",B]}),(0,b.jsxs)("p",{className:"text-center",children:[a("seat"),": ",D]})]})})}),(0,b.jsx)(p.ModalFooter,{children:(0,b.jsx)(l.Button,{color:"primary",onClick:Y,children:"OK"})})]}),c&&(0,b.jsxs)(m.Modal,{isOpen:Q.modal_static,toggle:X,centered:!0,size:"sm",children:[(0,b.jsxs)(n.ModalHeader,{toggle:X,children:[a("Failed"),"!"]}),(0,b.jsx)(o.ModalBody,{children:(0,b.jsx)(h.Row,{children:(0,b.jsx)(i.Col,{lg:12,children:(0,b.jsx)("p",{className:"text-center",children:a("failed_booking")})})})}),(0,b.jsx)(p.ModalFooter,{children:(0,b.jsx)(l.Button,{color:"primary",onClick:X,children:"OK"})})]})]})})})};function C(){return(0,b.jsx)(c.default,{children:(0,b.jsx)(B,{})})}a.s(["default",()=>C],25060)}];

//# sourceMappingURL=src_app_trip-search_page_tsx_3d4a90c5._.js.map