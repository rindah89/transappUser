{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from './types/database.types';\n\n/**\n * Middleware (Proxy Pattern) - Replaces old middleware approach\n * Handles authentication checks and route protection at the edge using Supabase Auth\n */\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  \n  // Initialize Supabase client for middleware\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\n  \n  if (!supabaseUrl || !supabaseAnonKey) {\n    // If Supabase is not configured, allow request through\n    return NextResponse.next();\n  }\n\n  const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n    auth: {\n      persistSession: false,\n      autoRefreshToken: false,\n    },\n  });\n\n  // Get access token from cookies or headers\n  const accessToken = request.cookies.get('sb-access-token')?.value || \n                     request.cookies.get('auth-token')?.value ||\n                     request.headers.get('authorization')?.replace('Bearer ', '');\n\n  let session = null;\n  let user = null;\n\n  // Verify session with Supabase Auth\n  if (accessToken) {\n    try {\n      const { data: { user: authUser }, error } = await supabase.auth.getUser(accessToken);\n      if (!error && authUser) {\n        user = authUser;\n        // Get session\n        const { data: sessionData } = await supabase.auth.getSession();\n        session = sessionData?.session;\n      }\n    } catch {\n      // Invalid token, continue without auth\n    }\n  }\n\n  // Protected routes that require authentication\n  const protectedRoutes = [\n    '/user-bookings',\n    '/ticket-form',\n    '/ticket-summary',\n  ];\n\n  // Check if the route is protected\n  const isProtectedRoute = protectedRoutes.some(route => pathname.startsWith(route));\n\n  // If accessing a protected route without valid session, redirect to login\n  if (isProtectedRoute && (!session || !user)) {\n    const url = request.nextUrl.clone();\n    url.pathname = '/login';\n    url.searchParams.set('redirect', pathname);\n    return NextResponse.redirect(url);\n  }\n\n  // If accessing login/register with valid session, redirect to home\n  if ((pathname === '/login' || pathname === '/register') && session && user) {\n    const url = request.nextUrl.clone();\n    url.pathname = '/';\n    return NextResponse.redirect(url);\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files (public folder)\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAOO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,4CAA4C;IAC5C,MAAM,cAAc,gFAAwC,QAAQ,GAAG,CAAC,YAAY;IACpF,MAAM,kBAAkB,QAAQ,GAAG,CAAC,6BAA6B;IAEjE;;IAKA,MAAM,WAAW,IAAA,+LAAY,EAAW,aAAa,iBAAiB;QACpE,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QACpB;IACF;IAEA,2CAA2C;IAC3C,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB,SACzC,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe,SACnC,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB,QAAQ,WAAW;IAE5E,IAAI,UAAU;IACd,IAAI,OAAO;IAEX,oCAAoC;IACpC,IAAI,aAAa;QACf,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO,CAAC;YACxE,IAAI,CAAC,SAAS,UAAU;gBACtB,OAAO;gBACP,cAAc;gBACd,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;gBAC5D,UAAU,aAAa;YACzB;QACF,EAAE,OAAM;QACN,uCAAuC;QACzC;IACF;IAEA,+CAA+C;IAC/C,MAAM,kBAAkB;QACtB;QACA;QACA;KACD;IAED,kCAAkC;IAClC,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IAE3E,0EAA0E;IAC1E,IAAI,oBAAoB,CAAC,CAAC,WAAW,CAAC,IAAI,GAAG;QAC3C,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;QACjC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,mEAAmE;IACnE,IAAI,CAAC,aAAa,YAAY,aAAa,WAAW,KAAK,WAAW,MAAM;QAC1E,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;KAOC,GACD;KACD;AACH"}}]
}